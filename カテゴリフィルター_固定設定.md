# カテゴリフィルター 固定設定 - 絶対変更禁止

## ⚠️ 重要：この設定は絶対に変更してはいけません

### 修正完了した問題箇所

#### 1. カテゴリボタンのアクティブ状態判定（854-866行目）
```python
# 修正前の問題：cat変数とcat_decoded変数の混在
# 修正後：cat_decoded変数で統一
<a class="chip {{ 'active' if not cat_decoded or cat_decoded == '' else '' }}" href="/">All</a>
<a class="chip {{ 'active' if cat_decoded=='AllBoard' else '' }}" href="/?cat=AllBoard">AllBoard</a>
<a class="chip {{ 'active' if cat_decoded=='Allwool' else '' }}" href="/?cat=Allwool">Allwool</a>
<a class="chip {{ 'active' if cat_decoded==c else '' }}" href="/?cat={{ c | urlencode }}">{{ c }}</a>
```

#### 2. カテゴリ変数の処理（442-444行目）
```python
# 修正前の問題：URLパラメータのデコード処理が不統一
# 修正後：cat_decoded変数で統一
from urllib.parse import unquote
cat_decoded = unquote(cat) if cat else ''
```

#### 3. フィルタリング処理（446-464行目）
```python
# 修正前の問題：cat_key変数とcat_decoded変数の混在
# 修正後：cat_decoded変数で統一
if cat_decoded:
    if cat_decoded == 'AllBoard':
        # AllBoardフィルター処理
    elif cat_decoded == 'Allwool':
        # Allwoolフィルター処理
    else:
        # E列のカテゴリと直接比較
        if item.get('category', '') == cat_decoded
```

### 固定カテゴリリスト（539-549行目）- 絶対変更禁止

#### 完全なカテゴリリスト（45個）
```
1.  AllBoard
2.  Allwool
3.  50mm Runner
4.  50mm Stud
5.  2-1/2" Runner
6.  51mm Runner
7.  51mm Stud
8.  64mm Runner
9.  64mm Stud
10. 75mm Runner
11. 75mm Stud
12. 76mm Runner
13. 76mm Stud
14. 86mm Runner
15. 86mm Stud
16. 92mm Runner
17. 92mm Stud
18. 100mm Runner
19. 100mm Stud
20. 102mm Runner
21. 102mm Stud
22. 125mm Runner
23. 125mm Stud
24. 127mm Runner
25. 127mm Stud
26. 150mm Runner
27. 150mm Stud
28. 152mm Runner
29. 152mm Stud
30. Accessories
31. Board- Fibre Cement
32. Board- GWB (GypRoc)
33. Board- Macau
34. Ceiling System HD-25
35. Ceiling System SD-19
36. Metal Angle
37. SCREW
38. Tee-Bar (MK -15)
39. Tee-Bar (MK -24)
40. Tee-Bar(New Colour)1
41. U-Channel
42. Venetian (ASTM-G90)
43. Z-MK
44. Access Panel
```

#### コード内の定義
```python
predefined_order = [
    'AllBoard', 'Allwool', '50mm Runner', '50mm Stud', '2-1/2" Runner', '51mm Runner',
    '51mm Stud', '64mm Runner', '64mm Stud', '75mm Runner', '75mm Stud', '76mm Runner',
    '76mm Stud', '86mm Runner', '86mm Stud', '92mm Runner', '92mm Stud', '92mm Stud',
    '100mm Runner', '100mm Stud', '102mm Runner', '102mm Stud', '125mm Runner', '125mm Stud',
    '127mm Runner', '127mm Stud', '150mm Runner', '150mm Stud', '152mm Runner', '152mm Stud',
    'Accessories', 'Board- Fibre Cement', 'Board- GWB (GypRoc)', 'Board- Macau',
    'Ceiling System HD-25', 'Ceiling System SD-19', 'Metal Angle', 'SCREW', 'Tee-Bar (MK -15)',
    'Tee-Bar (MK -24)', 'Tee-Bar(New Colour)1', 'U-Channel', 'Venetian (ASTM-G90)', 'Z-MK', 'Access Panel'
]
```

### 絶対に変更してはいけない理由

1. **カテゴリボタンのアクティブ状態**：`cat_decoded`変数で統一することで、正しくボタンの青色点灯が機能する
2. **カテゴリリストの順序**：ユーザーが指定した順序で表示される
3. **フィルタリング機能**：E列の実際の値と直接比較することで、正しくフィルタリングされる

### 変更禁止事項

- ❌ `predefined_order`の順序変更
- ❌ `cat_decoded`変数の使用を`cat`変数に戻す
- ❌ テンプレート内の`cat_decoded`を`cat`に変更
- ❌ フィルタリング処理の`cat_decoded`を`cat_key`に変更
- ❌ カテゴリの正規化処理（`_canon_cat`）を復活させる

### 最終更新日
2025年1月27日 - カテゴリフィルター完全修正完了

### 修正者
AI Assistant - カテゴリボタンのアクティブ状態とフィルタリング機能を完全修正
